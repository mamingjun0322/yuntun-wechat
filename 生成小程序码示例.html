<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‰¹é‡ç”Ÿæˆå°ç¨‹åºç </title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            padding: 40px;
        }
        
        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
        }
        
        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }
        
        .form-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
        }
        
        input, textarea, select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        textarea {
            min-height: 120px;
            font-family: monospace;
            resize: vertical;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
        }
        
        button {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: #667eea;
            color: white;
        }
        
        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-success:hover {
            background: #218838;
        }
        
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .result-section {
            margin-top: 30px;
        }
        
        .result-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .qrcode-item {
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            text-align: center;
            transition: transform 0.3s;
        }
        
        .qrcode-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .qrcode-item img {
            width: 100%;
            height: auto;
            border-radius: 4px;
            margin-bottom: 10px;
            border: 2px solid #ddd;
        }
        
        .qrcode-label {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }
        
        .qrcode-status {
            font-size: 12px;
            color: #28a745;
        }
        
        .status-error {
            color: #dc3545;
        }
        
        .log-section {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .log-item {
            padding: 8px;
            margin-bottom: 5px;
            background: white;
            border-radius: 4px;
            font-size: 13px;
            font-family: monospace;
        }
        
        .log-success {
            border-left: 3px solid #28a745;
        }
        
        .log-error {
            border-left: 3px solid #dc3545;
        }
        
        .log-info {
            border-left: 3px solid #17a2b8;
        }
        
        .preset-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .btn-preset {
            padding: 8px 16px;
            background: #e9ecef;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
        }
        
        .btn-preset:hover {
            background: #dee2e6;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¯ äº‘åå°ç¨‹åºç ç”Ÿæˆå·¥å…·</h1>
        <p class="subtitle">æ‰¹é‡ç”Ÿæˆå¸¦æ¡Œä½å·çš„å°ç¨‹åºç ï¼Œç”¨äºé¤å…æ¡Œä½æ‰«ç ç‚¹é¤</p>
        
        <div class="form-section">
            <div class="form-group">
                <label>åç«¯æ¥å£åœ°å€</label>
                <input type="text" id="apiUrl" value="http://localhost:8080/common/qrcode/generate" placeholder="è¾“å…¥åç«¯æ¥å£åœ°å€">
            </div>
            
            <div class="form-group">
                <label>è·³è½¬é¡µé¢è·¯å¾„ï¼ˆå¯é€‰ï¼‰</label>
                <input type="text" id="pagePath" value="pages/index/index" placeholder="é»˜è®¤ä¸ºé¦–é¡µ">
            </div>
            
            <div class="form-group">
                <label>æ¡Œä½å·åˆ—è¡¨ï¼ˆæ¯è¡Œä¸€ä¸ªï¼‰</label>
                <div class="preset-buttons">
                    <button class="btn-preset" onclick="setPreset('A')">AåŒº (A01-A10)</button>
                    <button class="btn-preset" onclick="setPreset('B')">BåŒº (B01-B10)</button>
                    <button class="btn-preset" onclick="setPreset('C')">CåŒº (C01-C10)</button>
                    <button class="btn-preset" onclick="setPreset('VIP')">VIPåŒº (VIP01-VIP05)</button>
                    <button class="btn-preset" onclick="clearTables()">æ¸…ç©º</button>
                </div>
                <textarea id="tableList" placeholder="ç¤ºä¾‹ï¼š&#10;A01&#10;A02&#10;A03&#10;B01&#10;B02">A01
A02
A03
B01
B02</textarea>
            </div>
            
            <div class="button-group">
                <button class="btn-primary" onclick="generateQrCodes()" id="generateBtn">
                    ğŸš€ å¼€å§‹ç”Ÿæˆ
                </button>
                <button class="btn-secondary" onclick="clearResults()">
                    ğŸ—‘ï¸ æ¸…ç©ºç»“æœ
                </button>
                <button class="btn-success" onclick="downloadAll()" id="downloadBtn" style="display: none;">
                    ğŸ“¥ ä¸‹è½½å…¨éƒ¨
                </button>
            </div>
        </div>
        
        <div class="result-section">
            <h3>ç”Ÿæˆç»“æœ</h3>
            <div class="result-grid" id="resultGrid"></div>
        </div>
        
        <div class="log-section">
            <h3>æ“ä½œæ—¥å¿—</h3>
            <div id="logContainer"></div>
        </div>
    </div>
    
    <script>
        let results = [];
        
        function log(message, type = 'info') {
            const logContainer = document.getElementById('logContainer');
            const logItem = document.createElement('div');
            logItem.className = `log-item log-${type}`;
            const time = new Date().toLocaleTimeString();
            logItem.textContent = `[${time}] ${message}`;
            logContainer.insertBefore(logItem, logContainer.firstChild);
        }
        
        function setPreset(zone) {
            const tableList = document.getElementById('tableList');
            const count = zone === 'VIP' ? 5 : 10;
            const tables = [];
            
            for (let i = 1; i <= count; i++) {
                const num = i.toString().padStart(2, '0');
                tables.push(`${zone}${num}`);
            }
            
            tableList.value = tables.join('\n');
            log(`å·²è®¾ç½®${zone}åŒºé¢„è®¾æ¡Œä½ (${count}ä¸ª)`, 'info');
        }
        
        function clearTables() {
            document.getElementById('tableList').value = '';
            log('å·²æ¸…ç©ºæ¡Œä½åˆ—è¡¨', 'info');
        }
        
        async function generateQrCodes() {
            const apiUrl = document.getElementById('apiUrl').value.trim();
            const pagePath = document.getElementById('pagePath').value.trim();
            const tableListText = document.getElementById('tableList').value.trim();
            
            if (!apiUrl) {
                alert('è¯·è¾“å…¥åç«¯æ¥å£åœ°å€');
                return;
            }
            
            if (!tableListText) {
                alert('è¯·è¾“å…¥æ¡Œä½å·åˆ—è¡¨');
                return;
            }
            
            const tables = tableListText.split('\n').map(t => t.trim()).filter(t => t);
            
            if (tables.length === 0) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„æ¡Œä½å·');
                return;
            }
            
            const generateBtn = document.getElementById('generateBtn');
            generateBtn.disabled = true;
            generateBtn.textContent = 'â³ ç”Ÿæˆä¸­...';
            
            results = [];
            clearResults();
            
            log(`å¼€å§‹ç”Ÿæˆ ${tables.length} ä¸ªå°ç¨‹åºç `, 'info');
            
            let successCount = 0;
            let failCount = 0;
            
            for (const tableNo of tables) {
                try {
                    const formData = new URLSearchParams();
                    formData.append('tableNo', tableNo);
                    if (pagePath) {
                        formData.append('page', pagePath);
                    }
                    
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded'
                        },
                        body: formData
                    });
                    
                    const data = await response.json();
                    
                    if (data.code === 0 && data.data && data.data.qrCodeUrl) {
                        const qrCodeUrl = data.data.qrCodeUrl;
                        const fullUrl = qrCodeUrl.startsWith('http') ? qrCodeUrl : apiUrl.replace(/\/common.*/, qrCodeUrl);
                        
                        results.push({
                            tableNo: tableNo,
                            url: fullUrl,
                            success: true
                        });
                        
                        addQrCodeToGrid(tableNo, fullUrl);
                        log(`âœ… ${tableNo} ç”ŸæˆæˆåŠŸ`, 'success');
                        successCount++;
                    } else {
                        throw new Error(data.message || 'ç”Ÿæˆå¤±è´¥');
                    }
                } catch (error) {
                    results.push({
                        tableNo: tableNo,
                        error: error.message,
                        success: false
                    });
                    log(`âŒ ${tableNo} ç”Ÿæˆå¤±è´¥: ${error.message}`, 'error');
                    failCount++;
                }
                
                // é¿å…è¯·æ±‚è¿‡å¿«
                await new Promise(resolve => setTimeout(resolve, 200));
            }
            
            generateBtn.disabled = false;
            generateBtn.textContent = 'ğŸš€ å¼€å§‹ç”Ÿæˆ';
            
            log(`ç”Ÿæˆå®Œæˆï¼æˆåŠŸ: ${successCount}, å¤±è´¥: ${failCount}`, successCount === tables.length ? 'success' : 'info');
            
            if (successCount > 0) {
                document.getElementById('downloadBtn').style.display = 'inline-block';
            }
        }
        
        function addQrCodeToGrid(tableNo, imageUrl) {
            const grid = document.getElementById('resultGrid');
            const item = document.createElement('div');
            item.className = 'qrcode-item';
            item.innerHTML = `
                <img src="${imageUrl}" alt="${tableNo}" onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%22200%22 height=%22200%22><text x=%2250%%22 y=%2250%%22 text-anchor=%22middle%22 dy=%22.3em%22>åŠ è½½å¤±è´¥</text></svg>'">
                <div class="qrcode-label">${tableNo}</div>
                <div class="qrcode-status">âœ“ ç”ŸæˆæˆåŠŸ</div>
                <button class="btn-preset" onclick="downloadSingle('${imageUrl}', '${tableNo}')" style="margin-top: 10px;">ä¸‹è½½</button>
            `;
            grid.appendChild(item);
        }
        
        function clearResults() {
            document.getElementById('resultGrid').innerHTML = '';
            document.getElementById('downloadBtn').style.display = 'none';
            results = [];
        }
        
        async function downloadSingle(url, tableNo) {
            try {
                const response = await fetch(url);
                const blob = await response.blob();
                const blobUrl = window.URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = blobUrl;
                a.download = `qrcode_${tableNo}.png`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(blobUrl);
                
                log(`ğŸ“¥ ${tableNo} ä¸‹è½½æˆåŠŸ`, 'success');
            } catch (error) {
                log(`âŒ ${tableNo} ä¸‹è½½å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        async function downloadAll() {
            const successResults = results.filter(r => r.success);
            
            if (successResults.length === 0) {
                alert('æ²¡æœ‰å¯ä¸‹è½½çš„å°ç¨‹åºç ');
                return;
            }
            
            log(`å¼€å§‹ä¸‹è½½ ${successResults.length} ä¸ªå°ç¨‹åºç `, 'info');
            
            for (const result of successResults) {
                await downloadSingle(result.url, result.tableNo);
                await new Promise(resolve => setTimeout(resolve, 500));
            }
            
            log(`âœ… å…¨éƒ¨ä¸‹è½½å®Œæˆ`, 'success');
        }
        
        // é¡µé¢åŠ è½½æ—¶çš„åˆå§‹åŒ–
        window.onload = function() {
            log('å·¥å…·å·²å°±ç»ªï¼Œè¯·é…ç½®å‚æ•°åå¼€å§‹ç”Ÿæˆ', 'info');
        };
    </script>
</body>
</html>

