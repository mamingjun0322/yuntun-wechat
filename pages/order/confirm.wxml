<!--pages/order/confirm.wxml-->
<wxs module="utils">
  var formatPrice = function(price) {
    // ä»·æ ¼å·²ç»æ˜¯ä»¥å…ƒä¸ºå•ä½ï¼Œç›´æ¥æ ¼å¼åŒ–å³å¯
    return price.toFixed(2);
  };
  
  module.exports = {
    formatPrice: formatPrice
  };
</wxs>

<view class="confirm-container">
  <scroll-view class="confirm-content" scroll-y>
    <!-- è®¢å•ç±»å‹é€‰æ‹© -->
    <view class="order-type-card card">
      <view class="card-title">è®¢å•ç±»å‹</view>
      <view class="type-options">
        <view 
          class="type-option {{orderType === 1 ? 'active' : ''}}"
          bindtap="switchOrderType"
          data-type="{{1}}"
        >
          <text class="type-icon">ğŸ½ï¸</text>
          <text class="type-name">å ‚é£Ÿ</text>
        </view>
        <view 
          class="type-option {{orderType === 2 ? 'active' : ''}}"
          bindtap="switchOrderType"
          data-type="{{2}}"
        >
          <text class="type-icon">ğŸ›µ</text>
          <text class="type-name">å¤–å–</text>
        </view>
      </view>
    </view>

    <!-- å ‚é£Ÿä¿¡æ¯ -->
    <view class="info-card card" wx:if="{{orderType === 1}}">
      <view class="card-title">ğŸ½ï¸ å ‚é£Ÿä¿¡æ¯</view>
      <view class="form-item">
        <text class="label">æ¡Œå·</text>
        <input 
          class="input" 
          placeholder="è¯·è¾“å…¥æ¡Œå·"
          value="{{tableNo}}"
          bindinput="inputTableNo"
        />
      </view>
      <view class="form-item">
        <text class="label">å°±é¤äººæ•°</text>
        <view class="people-select">
          <view 
            class="people-btn {{peopleCount === item ? 'active' : ''}}"
            wx:for="{{[1,2,3,4,5,6]}}"
            wx:key="*this"
            bindtap="selectPeopleCount"
            data-count="{{item}}"
          >
            {{item}}äºº
          </view>
        </view>
      </view>
    </view>

    <!-- å¤–å–ä¿¡æ¯ -->
    <view class="info-card card" wx:if="{{orderType === 2}}">
      <view class="card-title">ğŸ›µ é…é€ä¿¡æ¯</view>
      
      <!-- æ”¶è´§åœ°å€ -->
      <view class="address-section" bindtap="selectAddress">
        <view class="address-content" wx:if="{{address}}">
          <view class="address-header">
            <text class="receiver-name">{{address.name}}</text>
            <text class="receiver-phone">{{address.phone}}</text>
          </view>
          <view class="address-detail">{{address.region}} {{address.address}}</view>
        </view>
        <view class="no-address" wx:else>
          <text class="placeholder">è¯·é€‰æ‹©æ”¶è´§åœ°å€</text>
        </view>
        <text class="arrow">â€º</text>
      </view>

      <!-- é…é€æ—¶é—´ -->
      <view class="form-item" bindtap="selectDeliveryTime">
        <text class="label">é…é€æ—¶é—´</text>
        <view class="value">
          <text>{{deliveryTime}}</text>
          <text class="arrow">â€º</text>
        </view>
      </view>

      <!-- é¤å…· -->
      <view class="form-item">
        <text class="label">é¤å…·ä»½æ•°</text>
        <view class="tableware-select">
          <view 
            class="tableware-btn {{tableware === item ? 'active' : ''}}"
            wx:for="{{[0,1,2,3,4]}}"
            wx:key="*this"
            bindtap="selectTableware"
            data-count="{{item}}"
          >
            {{item}}ä»½
          </view>
        </view>
      </view>
    </view>

    <!-- å•†å“åˆ—è¡¨ -->
    <view class="goods-card card">
      <view class="card-title">å•†å“æ¸…å•</view>
      <view class="goods-list">
        <view class="goods-item" wx:for="{{goodsList}}" wx:key="id">
          <image 
            class="goods-image" 
            src="{{handleImageUrl(item.image)}}"
            mode="aspectFill"
          ></image>
          <view class="goods-info">
            <text class="goods-name">{{item.name}}</text>
            <view class="goods-specs" wx:if="{{item.specs && Object.keys(item.specs).length}}">
              <text 
                class="spec-text"
                wx:for="{{Object.values(item.specs)}}"
                wx:for-item="spec"
                wx:key="index"
              >
                {{spec.value}}
              </text>
            </view>
            <view class="goods-bottom">
              <text class="goods-price">Â¥{{utils.formatPrice(item.price)}}</text>
              <text class="goods-quantity">Ã—{{item.quantity}}</text>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- ä¼˜æƒ åˆ¸ -->
    <view class="coupon-card card" bindtap="selectCoupon">
      <text class="coupon-label">ä¼˜æƒ åˆ¸</text>
      <view class="coupon-value">
        <text class="coupon-text">{{selectedCoupon ? selectedCoupon.name : 'æš‚æ— å¯ç”¨'}}</text>
        <text class="arrow">â€º</text>
      </view>
    </view>

    <!-- å¤‡æ³¨ -->
    <view class="remark-card card">
      <view class="card-title">å¤‡æ³¨</view>
      <textarea 
        class="remark-input"
        placeholder="é€‰å¡«ï¼Œå¯ä»¥å‘Šè¯‰æˆ‘ä»¬æ‚¨çš„ç‰¹æ®Šè¦æ±‚"
        value="{{remark}}"
        bindinput="inputRemark"
        maxlength="200"
      />
    </view>

    <!-- è´¹ç”¨æ˜ç»† -->
    <view class="amount-card card">
      <view class="card-title">è´¹ç”¨æ˜ç»†</view>
      <view class="amount-item">
        <text class="amount-label">å•†å“æ€»é¢</text>
        <text class="amount-value">Â¥{{utils.formatPrice(goodsAmount)}}</text>
      </view>
      <view class="amount-item" wx:if="{{orderType === 2}}">
        <text class="amount-label">é…é€è´¹</text>
        <text class="amount-value">Â¥{{utils.formatPrice(deliveryFee)}}</text>
      </view>
      <view class="amount-item" wx:if="{{orderType === 2}}">
        <text class="amount-label">æ‰“åŒ…è´¹</text>
        <text class="amount-value">Â¥{{utils.formatPrice(packingFee)}}</text>
      </view>
      <view class="amount-item" wx:if="{{couponDiscount > 0}}">
        <text class="amount-label">ä¼˜æƒ åˆ¸</text>
        <text class="amount-value discount">-Â¥{{utils.formatPrice(couponDiscount)}}</text>
      </view>
    </view>
  </scroll-view>

  <!-- åº•éƒ¨æäº¤ -->
  <view class="bottom-bar safe-area-inset-bottom">
    <view class="total-amount">
      <text class="total-label">åˆè®¡ï¼š</text>
      <text class="total-symbol">Â¥</text>
      <text class="total-value">{{utils.formatPrice(totalAmount)}}</text>
    </view>
    <view 
      class="submit-btn {{submitting ? 'disabled' : ''}}" 
      catchtap="submitOrder"
    >
      {{submitting ? 'æäº¤ä¸­...' : 'æäº¤è®¢å•'}}
    </view>
  </view>
</view>
