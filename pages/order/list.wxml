<!--pages/order/list.wxml-->
<wxs module="utils">
  var formatPrice = function(price) {
    // ä»·æ ¼å·²ç»æ˜¯ä»¥å…ƒä¸ºå•ä½ï¼Œç›´æ¥æ ¼å¼åŒ–å³å¯
    return price.toFixed(2);
  };
  
  module.exports = {
    formatPrice: formatPrice
  };
</wxs>

<view class="order-list-container">
  <!-- Tabæ  -->
  <view class="tabs-bar">
    <scroll-view class="tabs-scroll" scroll-x>
      <view 
        class="tab-item {{currentTab === index ? 'active' : ''}}"
        wx:for="{{tabs}}"
        wx:key="status"
        bindtap="switchTab"
        data-index="{{index}}"
      >
        {{item.name}}
      </view>
    </scroll-view>
  </view>

  <!-- è®¢å•åˆ—è¡¨ -->
  <scroll-view class="order-list" scroll-y>
    <view 
      class="order-item" 
      wx:for="{{orderList}}" 
      wx:key="id"
      bindtap="goOrderDetail"
      data-id="{{item.id}}"
    >
      <!-- è®¢å•å¤´éƒ¨ -->
      <view class="order-header">
        <view class="order-header-left">
          <text class="order-no">è®¢å•å·ï¼š{{item.orderNo}}</text>
          <text class="order-time" wx:if="{{item.createTime}}">{{''}}</text>
        </view>
        <text class="order-status status-{{item.status}}">{{getOrderStatusText(item.status)}}</text>
      </view>

      <!-- å•†å“åˆ—è¡¨ -->
      <view class="goods-list">
        <view class="goods-item" wx:for="{{item.goodsList}}" wx:for-item="goods" wx:key="id">
          <image 
            class="goods-image" 
            src="{{goods.image}}"
            mode="aspectFill"
          ></image>
          <view class="goods-info">
            <text class="goods-name">{{goods.name}}</text>
            <view class="goods-specs" wx:if="{{goods.specs && goods.specs.length}}">
              <text class="spec-item" wx:for="{{goods.specs}}" wx:for-item="spec" wx:key="index">
                {{spec.value}}
              </text>
            </view>
            <view class="goods-bottom">
              <text class="goods-price">Â¥{{utils.formatPrice(goods.price)}}</text>
              <text class="goods-quantity">Ã—{{goods.quantity}}</text>
            </view>
          </view>
        </view>
      </view>

      <!-- è®¢å•ä¿¡æ¯ -->
      <view class="order-info">
        <text class="order-type">{{item.type === 1 ? 'ğŸ½ï¸ å ‚é£Ÿ' : 'ğŸ›µ å¤–å–'}}</text>
        <view class="order-amount">
          <text class="amount-label">åˆè®¡ï¼š</text>
          <text class="amount-value">Â¥{{utils.formatPrice(item.totalAmount)}}</text>
        </view>
      </view>

      <!-- è®¢å•æ“ä½œ -->
      <view class="order-actions" catchtap="stopPropagation">
        <!-- å¾…æ”¯ä»˜ -->
        <block wx:if="{{item.status === 1}}">
          <view 
            class="action-btn cancel-btn" 
            catchtap="cancelOrder"
            data-id="{{item.id}}"
            data-index="{{index}}"
          >
            å–æ¶ˆè®¢å•
          </view>
          <view 
            class="action-btn primary-btn" 
            catchtap="goPay"
            data-id="{{item.id}}"
          >
            å»æ”¯ä»˜
          </view>
        </block>

        <!-- åˆ¶ä½œä¸­ -->
        <block wx:if="{{item.status === 2}}">
          <view class="action-btn disabled-btn">åˆ¶ä½œä¸­</view>
        </block>

        <!-- é…é€ä¸­ -->
        <block wx:if="{{item.status === 3}}">
          <view class="action-btn disabled-btn">é…é€ä¸­</view>
        </block>

        <!-- å·²å®Œæˆ -->
        <block wx:if="{{item.status === 4}}">
          <view 
            class="action-btn plain-btn"
            catchtap="orderAgain"
            data-order="{{item}}"
          >
            å†æ¥ä¸€å•
          </view>
          <view 
            class="action-btn primary-btn"
            wx:if="{{!item.commented}}"
            catchtap="goComment"
            data-id="{{item.id}}"
          >
            å»è¯„ä»·
          </view>
        </block>

        <!-- å·²å–æ¶ˆ -->
        <block wx:if="{{item.status === 5}}">
          <view class="action-btn disabled-btn">å·²å–æ¶ˆ</view>
        </block>
      </view>
    </view>

    <!-- åŠ è½½çŠ¶æ€ -->
    <view class="load-more" wx:if="{{orderList.length}}">
      <text class="load-text" wx:if="{{!noMore}}">åŠ è½½æ›´å¤š...</text>
      <text class="load-text" wx:else>æ²¡æœ‰æ›´å¤šäº†</text>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{!loading && !orderList.length}}">
      <text class="empty-icon">ğŸ“‹</text>
      <text class="empty-text">æš‚æ— è®¢å•</text>
      <view class="empty-btn" bindtap="goIndex">å»é€›é€›</view>
    </view>
  </scroll-view>
</view>
