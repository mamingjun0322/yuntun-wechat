<!--pages/cart/cart.wxml-->
<wxs module="utils">
  var formatPrice = function(price) {
    // ä»·æ ¼å·²ç»æ˜¯ä»¥å…ƒä¸ºå•ä½ï¼Œç›´æ¥æ ¼å¼åŒ–å³å¯
    return price.toFixed(2);
  };
  
  module.exports = {
    formatPrice: formatPrice
  };
</wxs>

<view class="cart-container">
  <!-- è´­ç‰©è½¦åˆ—è¡¨ -->
  <scroll-view class="cart-list" scroll-y wx:if="{{cartList.length}}">
    <view 
      class="cart-item" 
      wx:for="{{cartList}}" 
      wx:key="index"
    >
      <!-- é€‰æ‹©æ¡† -->
      <view 
        class="checkbox {{item.selected ? 'checked' : ''}}"
        bindtap="toggleSelect"
        data-index="{{index}}"
      >
        <text class="check-icon" wx:if="{{item.selected}}">âœ“</text>
      </view>

      <!-- å•†å“ä¿¡æ¯ -->
      <image 
        class="goods-image" 
        src="{{handleImageUrl(item.image)}}" 
        mode="aspectFill"
      ></image>

      <view class="goods-info">
        <view class="goods-name">{{item.name}}</view>
        
        <!-- è§„æ ¼ -->
        <view class="goods-specs" wx:if="{{item.specs && Object.keys(item.specs).length}}">
          <text 
            class="spec-item" 
            wx:for="{{Object.keys(item.specs)}}" 
            wx:for-item="key"
            wx:key="key"
          >
            {{item.specs[key].value}}
          </text>
        </view>

        <view class="goods-footer">
          <view class="price">
            <text class="price-symbol">Â¥</text>
            <text class="price-value">{{utils.formatPrice(item.price)}}</text>
          </view>

          <!-- æ•°é‡æ§åˆ¶ -->
          <view class="quantity-control">
            <view 
              class="control-btn" 
              bindtap="decreaseQuantity"
              data-index="{{index}}"
            >
              -
            </view>
            <view class="quantity-value">{{item.quantity}}</view>
            <view 
              class="control-btn" 
              bindtap="increaseQuantity"
              data-index="{{index}}"
            >
              +
            </view>
          </view>
        </view>
      </view>
    </view>
  </scroll-view>

  <!-- ç©ºè´­ç‰©è½¦ -->
  <view class="empty-cart" wx:else>
    <text class="empty-icon">ğŸ›’</text>
    <text class="empty-text">è´­ç‰©è½¦æ˜¯ç©ºçš„</text>
    <view class="empty-btn" bindtap="goIndex">å»é€›é€›</view>
  </view>

  <!-- åº•éƒ¨ç»“ç®—æ  -->
  <view class="bottom-bar safe-area-inset-bottom" wx:if="{{cartList.length}}">
    <view class="bar-left">
      <!-- å…¨é€‰ -->
      <view class="select-all" bindtap="toggleSelectAll">
        <view class="checkbox {{allSelected ? 'checked' : ''}}">
          <text class="check-icon" wx:if="{{allSelected}}">âœ“</text>
        </view>
        <text class="select-text">å…¨é€‰</text>
      </view>

      <!-- åˆè®¡ -->
      <view class="total-info">
        <text class="total-label">åˆè®¡ï¼š</text>
        <text class="total-symbol">Â¥</text>
        <text class="total-value">{{utils.formatPrice(totalPrice)}}</text>
      </view>
    </view>

    <!-- ç»“ç®—æŒ‰é’® -->
    <view 
      class="checkout-btn {{totalQuantity > 0 ? 'active' : ''}}" 
      bindtap="checkout"
    >
      ç»“ç®—({{totalQuantity}})
    </view>
  </view>
</view>
