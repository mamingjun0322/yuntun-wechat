<!--pages/goods/detail.wxml-->
<wxs module="utils">
  var formatPrice = function(price) {
    // ä»·æ ¼å·²ç»æ˜¯ä»¥å…ƒä¸ºå•ä½ï¼Œç›´æ¥æ ¼å¼åŒ–å³å¯
    return price.toFixed(2);
  };
  
  module.exports = {
    formatPrice: formatPrice
  };
</wxs>

<view class="detail-container">
  <!-- å›¾ç‰‡è½®æ’­ -->
  <view class="images-section">
    <swiper 
      class="images-swiper" 
      indicator-dots 
      autoplay 
      circular
      bindchange="onImageChange"
    >
      <swiper-item 
        wx:for="{{images}}" 
        wx:key="index"
        bindtap="previewImage"
        data-url="{{item}}"
      >
        <image 
          class="goods-image" 
          src="{{item}}" 
          mode="aspectFill"
        ></image>
      </swiper-item>
    </swiper>
    <view class="image-indicator">
      {{currentImageIndex + 1}} / {{images.length}}
    </view>
  </view>

  <!-- å•†å“ä¿¡æ¯ -->
  <view class="info-section card">
    <view class="price-box">
      <view class="current-price">
        <text class="price-symbol">Â¥</text>
        <text class="price-value">{{utils.formatPrice(goods.price)}}</text>
      </view>
      <view class="original-price" wx:if="{{goods.originalPrice}}">
        Â¥{{utils.formatPrice(goods.originalPrice)}}
      </view>
    </view>
    
    <view class="goods-name">{{goods.name}}</view>
    <view class="goods-desc">{{goods.description}}</view>
    
    <view class="goods-tags">
      <text class="tag" wx:if="{{goods.tag}}">{{goods.tag}}</text>
      <text class="tag sales-tag">å·²å”®{{goods.sales}}</text>
    </view>
  </view>

  <!-- è§„æ ¼é€‰æ‹© -->
  <view class="spec-section card" bindtap="showSpecModal">
    <text class="section-label">é€‰æ‹©è§„æ ¼</text>
    <view class="spec-value">
      <text class="spec-text">è¯·é€‰æ‹©è§„æ ¼</text>
      <text class="arrow">â€º</text>
    </view>
  </view>

  <!-- å•†å“è¯¦æƒ… -->
  <view class="detail-section card">
    <view class="section-title">å•†å“è¯¦æƒ…</view>
    <view class="detail-content">
      <text class="detail-text">{{goods.detail || 'æš‚æ— è¯¦æƒ…'}}</text>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œæ  -->
  <view class="bottom-bar safe-area-inset-bottom">
    <view class="bar-left">
      <view class="bar-btn" bindtap="goBack">
        <text class="btn-icon">ğŸ </text>
        <text class="btn-text">é¦–é¡µ</text>
      </view>
    </view>
    <view class="bar-right">
      <view class="btn-plain" bindtap="showSpecModal" data-action="addCart">åŠ å…¥è´­ç‰©è½¦</view>
      <view class="btn-primary" bindtap="showSpecModal" data-action="buyNow">ç«‹å³è´­ä¹°</view>
    </view>
  </view>

  <!-- è§„æ ¼é€‰æ‹©å¼¹çª— -->
  <view class="spec-modal {{showSpecModal ? 'show' : ''}}" wx:if="{{showSpecModal}}">
    <view class="modal-mask" bindtap="hideSpecModal"></view>
    <view class="modal-content">
      <!-- å•†å“é¢„è§ˆ -->
      <view class="modal-header">
        <image 
          class="modal-image" 
          src="{{goods.images ? goods.images[0] : ''}}"
          mode="aspectFill"
        ></image>
        <view class="modal-info">
          <view class="modal-price">Â¥{{utils.formatPrice(goods.price)}}</view>
          <view class="modal-stock">åº“å­˜ï¼š{{goods.stock}}</view>
        </view>
        <text class="modal-close" bindtap="hideSpecModal">âœ•</text>
      </view>

      <!-- è§„æ ¼é€‰æ‹© -->
      <scroll-view class="modal-body" scroll-y>
        <view class="spec-group" wx:if="{{goods.hasSpecs && goods.specsList}}" wx:for="{{goods.specsList}}" wx:key="name">
          <view class="spec-name">{{item.name}}</view>
          <view class="spec-options">
            <view 
              class="spec-option {{selectedSpecs[item.name] && selectedSpecs[item.name].id === option.id ? 'active' : ''}}"
              wx:for="{{item.options}}"
              wx:for-item="option"
              wx:key="id"
              bindtap="selectSpec"
              data-name="{{item.name}}"
              data-option="{{option}}"
            >
              {{option.value}}
            </view>
          </view>
        </view>

        <!-- æ•°é‡é€‰æ‹© -->
        <view class="quantity-section">
          <text class="quantity-label">æ•°é‡</text>
          <view class="quantity-control">
            <view class="control-btn" bindtap="decreaseQuantity">-</view>
            <view class="quantity-value">{{quantity}}</view>
            <view class="control-btn" bindtap="increaseQuantity">+</view>
          </view>
        </view>
      </scroll-view>

      <!-- åº•éƒ¨æŒ‰é’® -->
      <view class="modal-footer">
        <view class="modal-btn add-cart-btn" bindtap="confirmSpec" data-action="addCart">åŠ å…¥è´­ç‰©è½¦</view>
        <view class="modal-btn buy-now-btn" bindtap="confirmSpec" data-action="buyNow">ç«‹å³è´­ä¹°</view>
      </view>
    </view>
  </view>
</view>
