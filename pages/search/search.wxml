<!--pages/search/search.wxml-->
<wxs module="utils">
  var formatPrice = function(price) {
    return price.toFixed(2);
  };
  
  module.exports = {
    formatPrice: formatPrice
  };
</wxs>

<view class="search-page">
  <!-- æœç´¢æ  -->
  <view class="search-bar" style="padding-top: {{statusBarHeight}}px;">
    <view class="search-content">
      <view class="search-box">
        <text class="icon-search">ğŸ”</text>
        <input 
          class="search-input" 
          type="text" 
          placeholder="æœç´¢å•†å“åç§°"
          value="{{keyword}}"
          bindinput="onInputChange"
          bindconfirm="onSearch"
          focus="{{autoFocus}}"
        />
        <text class="icon-clear" wx:if="{{keyword}}" bindtap="onClearInput">âœ•</text>
      </view>
      <text class="btn-cancel" bindtap="onCancel">å–æ¶ˆ</text>
    </view>
  </view>

  <!-- æœç´¢å†å² -->
  <view class="search-history" wx:if="{{!keyword && searchHistory.length > 0}}">
    <view class="history-header">
      <text class="history-title">æœç´¢å†å²</text>
      <text class="btn-clear-history" bindtap="onClearHistory">
        <text class="icon-delete">ğŸ—‘ï¸</text>
        æ¸…ç©º
      </text>
    </view>
    <view class="history-tags">
      <view 
        class="history-tag" 
        wx:for="{{searchHistory}}" 
        wx:key="index"
        bindtap="onHistoryTap"
        data-keyword="{{item}}"
      >
        {{item}}
      </view>
    </view>
  </view>

  <!-- çƒ­é—¨æœç´¢ -->
  <view class="hot-search" wx:if="{{!keyword && hotKeywords.length > 0}}">
    <view class="hot-header">
      <text class="hot-title">ğŸ”¥ çƒ­é—¨æœç´¢</text>
    </view>
    <view class="hot-tags">
      <view 
        class="hot-tag" 
        wx:for="{{hotKeywords}}" 
        wx:key="index"
        bindtap="onHotKeywordTap"
        data-keyword="{{item}}"
      >
        {{item}}
      </view>
    </view>
  </view>

  <!-- æœç´¢ç»“æœ -->
  <view class="search-result" wx:if="{{keyword && hasSearched}}">
    <!-- ç»“æœç»Ÿè®¡ -->
    <view class="result-info" wx:if="{{goodsList.length > 0}}">
      æ‰¾åˆ° <text class="result-count">{{total}}</text> ä¸ªç›¸å…³å•†å“
    </view>

    <!-- å•†å“åˆ—è¡¨ -->
    <view class="goods-list" wx:if="{{goodsList.length > 0}}">
      <view 
        class="goods-item" 
        wx:for="{{goodsList}}" 
        wx:key="id"
        bindtap="goGoodsDetail"
        data-id="{{item.id}}"
      >
        <image 
          class="goods-image" 
          src="{{item.image}}" 
          mode="aspectFill"
        ></image>
        <view class="goods-info">
          <view class="goods-name">{{item.name}}</view>
          <view class="goods-desc" wx:if="{{item.description}}">{{item.description}}</view>
          <view class="goods-footer">
            <view class="goods-price-box">
              <text class="price-symbol">Â¥</text>
              <text class="price-value">{{utils.formatPrice(item.price)}}</text>
              <text class="price-original" wx:if="{{item.originalPrice}}">Â¥{{utils.formatPrice(item.originalPrice)}}</text>
            </view>
            <view class="goods-sales">å·²å”®{{item.sales || 0}}</view>
          </view>
        </view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-result" wx:if="{{goodsList.length === 0 && !loading}}">
      <image class="empty-icon" src="/images/empty-search.png" mode="aspectFit"></image>
      <view class="empty-text">æ²¡æœ‰æ‰¾åˆ°ç›¸å…³å•†å“</view>
      <view class="empty-tip">è¯•è¯•å…¶ä»–å…³é”®è¯å§~</view>
    </view>

    <!-- åŠ è½½æ›´å¤š -->
    <view class="load-more" wx:if="{{goodsList.length > 0}}">
      <text wx:if="{{loading}}">åŠ è½½ä¸­...</text>
      <text wx:elif="{{noMore}}">æ²¡æœ‰æ›´å¤šäº†</text>
    </view>
  </view>
</view>
